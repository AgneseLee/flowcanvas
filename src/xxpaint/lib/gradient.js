"use strict";
!(function () {
    var api = {
        isGradient: function (bg) {
            if (bg && (bg.startsWith('linear') || bg.startsWith('radial'))) {
                return true;
            }
            return false;
        },
        doGradient: function (bg, width, height, ctx) {
            if (bg.startsWith('linear')) {
                linearEffect(width, height, bg, ctx);
            }
            else if (bg.startsWith('radial')) {
                radialEffect(width, height, bg, ctx);
            }
        },
    };
    function analizeGrad(string) {
        var colorPercents = string.substring(0, string.length - 1).split('%,');
        var colors = [];
        var percents = [];
        for (var _i = 0, colorPercents_1 = colorPercents; _i < colorPercents_1.length; _i++) {
            var colorPercent = colorPercents_1[_i];
            colors.push(colorPercent.substring(0, colorPercent.lastIndexOf(' ')).trim());
            percents.push(colorPercent.substring(colorPercent.lastIndexOf(' '), colorPercent.length) / 100);
        }
        return { colors: colors, percents: percents };
    }
    function radialEffect(width, height, bg, ctx) {
        var colorPer = analizeGrad(bg.match(/radial-gradient\((.+)\)/)[1]);
        var grd = ctx.createCircularGradient(0, 0, width < height ? height / 2 : width / 2);
        for (var i = 0; i < colorPer.colors.length; i++) {
            grd.addColorStop(colorPer.percents[i], colorPer.colors[i]);
        }
        ctx.fillStyle = grd;
    }
    function analizeLinear(bg, width, height) {
        var direction = bg.match(/([-]?\d{1,3})deg/);
        var dir = direction && direction[1] ? parseFloat(direction[1]) : 0;
        var coordinate;
        switch (dir) {
            case 0:
                coordinate = [0, -height / 2, 0, height / 2];
                break;
            case 90:
                coordinate = [width / 2, 0, -width / 2, 0];
                break;
            case -90:
                coordinate = [-width / 2, 0, width / 2, 0];
                break;
            case 180:
                coordinate = [0, height / 2, 0, -height / 2];
                break;
            case -180:
                coordinate = [0, -height / 2, 0, height / 2];
                break;
            default:
                var x1 = 0;
                var y1 = 0;
                var x2 = 0;
                var y2 = 0;
                if (direction[1] > 0 && direction[1] < 90) {
                    x1 = (width / 2) - ((width / 2) * Math.tan((90 - direction[1]) * Math.PI * 2 / 360) - height / 2) * Math.sin(2 * (90 - direction[1]) * Math.PI * 2 / 360) / 2;
                    y2 = Math.tan((90 - direction[1]) * Math.PI * 2 / 360) * x1;
                    x2 = -x1;
                    y1 = -y2;
                }
                else if (direction[1] > -180 && direction[1] < -90) {
                    x1 = -(width / 2) + ((width / 2) * Math.tan((90 - direction[1]) * Math.PI * 2 / 360) - height / 2) * Math.sin(2 * (90 - direction[1]) * Math.PI * 2 / 360) / 2;
                    y2 = Math.tan((90 - direction[1]) * Math.PI * 2 / 360) * x1;
                    x2 = -x1;
                    y1 = -y2;
                }
                else if (direction[1] > 90 && direction[1] < 180) {
                    x1 = (width / 2) + (-(width / 2) * Math.tan((90 - direction[1]) * Math.PI * 2 / 360) - height / 2) * Math.sin(2 * (90 - direction[1]) * Math.PI * 2 / 360) / 2;
                    y2 = Math.tan((90 - direction[1]) * Math.PI * 2 / 360) * x1;
                    x2 = -x1;
                    y1 = -y2;
                }
                else {
                    x1 = -(width / 2) - (-(width / 2) * Math.tan((90 - direction[1]) * Math.PI * 2 / 360) - height / 2) * Math.sin(2 * (90 - direction[1]) * Math.PI * 2 / 360) / 2;
                    y2 = Math.tan((90 - direction[1]) * Math.PI * 2 / 360) * x1;
                    x2 = -x1;
                    y1 = -y2;
                }
                coordinate = [x1, y1, x2, y2];
                break;
        }
        return coordinate;
    }
    function linearEffect(width, height, bg, ctx) {
        var param = analizeLinear(bg, width, height);
        var grd = ctx.createLinearGradient(param[0], param[1], param[2], param[3]);
        var content = bg.match(/linear-gradient\((.+)\)/)[1];
        var colorPer = analizeGrad(content.substring(content.indexOf(',') + 1));
        for (var i = 0; i < colorPer.colors.length; i++) {
            grd.addColorStop(colorPer.percents[i], colorPer.colors[i]);
        }
        ctx.fillStyle = grd;
    }
    module.exports = { api: api };
}());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JhZGllbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJncmFkaWVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBSUEsQ0FBQyxDQUFDO0lBQ0EsSUFBTSxHQUFHLEdBQUc7UUFDVixVQUFVLFlBQUMsRUFBRTtZQUNYLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUU7Z0JBQzlELE9BQU8sSUFBSSxDQUFDO2FBQ2I7WUFDRCxPQUFPLEtBQUssQ0FBQztRQUNmLENBQUM7UUFFRCxVQUFVLFlBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsR0FBRztZQUMvQixJQUFJLEVBQUUsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQUU7Z0JBQzNCLFlBQVksQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxHQUFHLENBQUMsQ0FBQzthQUN0QztpQkFBTSxJQUFJLEVBQUUsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQUU7Z0JBQ2xDLFlBQVksQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxHQUFHLENBQUMsQ0FBQzthQUN0QztRQUNILENBQUM7S0FDRixDQUFDO0lBRUYsU0FBUyxXQUFXLENBQUMsTUFBTTtRQUN6QixJQUFNLGFBQWEsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6RSxJQUFNLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFDbEIsSUFBTSxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLEtBQTJCLFVBQWEsRUFBYiwrQkFBYSxFQUFiLDJCQUFhLEVBQWIsSUFBYSxFQUFFO1lBQXJDLElBQU0sWUFBWSxzQkFBQTtZQUNyQixNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLFlBQVksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBQzdFLFFBQVEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxFQUFFLFlBQVksQ0FBQyxNQUFNLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztTQUNqRztRQUNELE9BQU8sRUFBRSxNQUFNLFFBQUEsRUFBRSxRQUFRLFVBQUEsRUFBRSxDQUFDO0lBQzlCLENBQUM7SUFFRCxTQUFTLFlBQVksQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxHQUFHO1FBQzFDLElBQU0sUUFBUSxHQUFHLFdBQVcsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyRSxJQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxLQUFLLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDdEYsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQy9DLEdBQUcsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRSxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDNUQ7UUFDRCxHQUFHLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQztJQUV0QixDQUFDO0lBRUQsU0FBUyxhQUFhLENBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNO1FBQ3RDLElBQU0sU0FBUyxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUMvQyxJQUFNLEdBQUcsR0FBRyxTQUFTLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyRSxJQUFJLFVBQVUsQ0FBQztRQUNmLFFBQVEsR0FBRyxFQUFFO1lBQ2IsS0FBSyxDQUFDO2dCQUFFLFVBQVUsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFBQyxNQUFNO1lBQzVELEtBQUssRUFBRTtnQkFBRSxVQUFVLEdBQUcsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQUMsTUFBTTtZQUMzRCxLQUFLLENBQUMsRUFBRTtnQkFBRSxVQUFVLEdBQUcsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQUMsTUFBTTtZQUM1RCxLQUFLLEdBQUc7Z0JBQUUsVUFBVSxHQUFHLENBQUMsQ0FBQyxFQUFFLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUFDLE1BQU07WUFDOUQsS0FBSyxDQUFDLEdBQUc7Z0JBQUUsVUFBVSxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUFDLE1BQU07WUFDL0Q7Z0JBQ0UsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUNYLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDWCxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7Z0JBQ1gsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUNYLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO29CQUN6QyxFQUFFLEdBQUcsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQzlKLEVBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztvQkFDNUQsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDO29CQUNULEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQztpQkFDVjtxQkFBTSxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUU7b0JBQ3BELEVBQUUsR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUMvSixFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7b0JBQzVELEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQztvQkFDVCxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUM7aUJBQ1Y7cUJBQU0sSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLEVBQUU7b0JBQ2xELEVBQUUsR0FBRyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUMvSixFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7b0JBQzVELEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQztvQkFDVCxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUM7aUJBQ1Y7cUJBQU07b0JBQ0wsRUFBRSxHQUFHLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDaEssRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDO29CQUM1RCxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUM7b0JBQ1QsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDO2lCQUNWO2dCQUNELFVBQVUsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO2dCQUM5QixNQUFNO1NBQ1A7UUFDRCxPQUFPLFVBQVUsQ0FBQztJQUNwQixDQUFDO0lBRUQsU0FBUyxZQUFZLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsR0FBRztRQUMxQyxJQUFNLEtBQUssR0FBRyxhQUFhLENBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztRQUMvQyxJQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsb0JBQW9CLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0UsSUFBTSxPQUFPLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZELElBQU0sUUFBUSxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxRSxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDL0MsR0FBRyxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUM1RDtRQUNELEdBQUcsQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDO0lBRXRCLENBQUM7SUFFRCxNQUFNLENBQUMsT0FBTyxHQUFHLEVBQUUsR0FBRyxLQUFBLEVBQUUsQ0FBQztBQUMzQixDQUFDLEVBQUUsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8g5b2TY3R45Lyg5YWl5b2T5YmN5paH5Lu277yMY29uc3QgZ3JkID0gY3R4LmNyZWF0ZUNpcmN1bGFyR3JhZGllbnQoKSDlkoxcbi8vIGNvbnN0IGdyZCA9IHRoaXMuY3R4LmNyZWF0ZUxpbmVhckdyYWRpZW50KCkg5peg5pWI77yM5Zug5q2k5Y+q6IO95YiG5byA5aSE55CGXG4vLyDlhYjliIbmnpDvvIzlnKjlpJbpg6jliJvlu7pncmTvvIzlho3kvKDlhaXkvb/nlKjlsLHlj6/ku6VcblxuIShmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IGFwaSA9IHtcbiAgICBpc0dyYWRpZW50KGJnKSB7XG4gICAgICBpZiAoYmcgJiYgKGJnLnN0YXJ0c1dpdGgoJ2xpbmVhcicpIHx8IGJnLnN0YXJ0c1dpdGgoJ3JhZGlhbCcpKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgZG9HcmFkaWVudChiZywgd2lkdGgsIGhlaWdodCwgY3R4KSB7XG4gICAgICBpZiAoYmcuc3RhcnRzV2l0aCgnbGluZWFyJykpIHtcbiAgICAgICAgbGluZWFyRWZmZWN0KHdpZHRoLCBoZWlnaHQsIGJnLCBjdHgpO1xuICAgICAgfSBlbHNlIGlmIChiZy5zdGFydHNXaXRoKCdyYWRpYWwnKSkge1xuICAgICAgICByYWRpYWxFZmZlY3Qod2lkdGgsIGhlaWdodCwgYmcsIGN0eCk7XG4gICAgICB9XG4gICAgfSxcbiAgfTtcblxuICBmdW5jdGlvbiBhbmFsaXplR3JhZChzdHJpbmcpIHtcbiAgICBjb25zdCBjb2xvclBlcmNlbnRzID0gc3RyaW5nLnN1YnN0cmluZygwLCBzdHJpbmcubGVuZ3RoIC0gMSkuc3BsaXQoJyUsJyk7XG4gICAgY29uc3QgY29sb3JzID0gW107XG4gICAgY29uc3QgcGVyY2VudHMgPSBbXTtcbiAgICBmb3IgKGNvbnN0IGNvbG9yUGVyY2VudCBvZiBjb2xvclBlcmNlbnRzKSB7XG4gICAgICBjb2xvcnMucHVzaChjb2xvclBlcmNlbnQuc3Vic3RyaW5nKDAsIGNvbG9yUGVyY2VudC5sYXN0SW5kZXhPZignICcpKS50cmltKCkpO1xuICAgICAgcGVyY2VudHMucHVzaChjb2xvclBlcmNlbnQuc3Vic3RyaW5nKGNvbG9yUGVyY2VudC5sYXN0SW5kZXhPZignICcpLCBjb2xvclBlcmNlbnQubGVuZ3RoKSAvIDEwMCk7XG4gICAgfVxuICAgIHJldHVybiB7IGNvbG9ycywgcGVyY2VudHMgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJhZGlhbEVmZmVjdCh3aWR0aCwgaGVpZ2h0LCBiZywgY3R4KSB7XG4gICAgY29uc3QgY29sb3JQZXIgPSBhbmFsaXplR3JhZChiZy5tYXRjaCgvcmFkaWFsLWdyYWRpZW50XFwoKC4rKVxcKS8pWzFdKTtcbiAgICBjb25zdCBncmQgPSBjdHguY3JlYXRlQ2lyY3VsYXJHcmFkaWVudCgwLCAwLCB3aWR0aCA8IGhlaWdodCA/IGhlaWdodCAvIDIgOiB3aWR0aCAvIDIpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29sb3JQZXIuY29sb3JzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBncmQuYWRkQ29sb3JTdG9wKGNvbG9yUGVyLnBlcmNlbnRzW2ldLCBjb2xvclBlci5jb2xvcnNbaV0pO1xuICAgIH1cbiAgICBjdHguZmlsbFN0eWxlID0gZ3JkO1xuICAgIC8vIGN0eC5maWxsUmVjdCgtKHdpZHRoIC8gMiksIC0oaGVpZ2h0IC8gMiksIHdpZHRoLCBoZWlnaHQpO1xuICB9XG5cbiAgZnVuY3Rpb24gYW5hbGl6ZUxpbmVhcihiZywgd2lkdGgsIGhlaWdodCkge1xuICAgIGNvbnN0IGRpcmVjdGlvbiA9IGJnLm1hdGNoKC8oWy1dP1xcZHsxLDN9KWRlZy8pO1xuICAgIGNvbnN0IGRpciA9IGRpcmVjdGlvbiAmJiBkaXJlY3Rpb25bMV0gPyBwYXJzZUZsb2F0KGRpcmVjdGlvblsxXSkgOiAwO1xuICAgIGxldCBjb29yZGluYXRlO1xuICAgIHN3aXRjaCAoZGlyKSB7XG4gICAgY2FzZSAwOiBjb29yZGluYXRlID0gWzAsIC1oZWlnaHQgLyAyLCAwLCBoZWlnaHQgLyAyXTsgYnJlYWs7XG4gICAgY2FzZSA5MDogY29vcmRpbmF0ZSA9IFt3aWR0aCAvIDIsIDAsIC13aWR0aCAvIDIsIDBdOyBicmVhaztcbiAgICBjYXNlIC05MDogY29vcmRpbmF0ZSA9IFstd2lkdGggLyAyLCAwLCB3aWR0aCAvIDIsIDBdOyBicmVhaztcbiAgICBjYXNlIDE4MDogY29vcmRpbmF0ZSA9IFswLCBoZWlnaHQgLyAyLCAwLCAtaGVpZ2h0IC8gMl07IGJyZWFrO1xuICAgIGNhc2UgLTE4MDogY29vcmRpbmF0ZSA9IFswLCAtaGVpZ2h0IC8gMiwgMCwgaGVpZ2h0IC8gMl07IGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICBsZXQgeDEgPSAwO1xuICAgICAgbGV0IHkxID0gMDtcbiAgICAgIGxldCB4MiA9IDA7XG4gICAgICBsZXQgeTIgPSAwO1xuICAgICAgaWYgKGRpcmVjdGlvblsxXSA+IDAgJiYgZGlyZWN0aW9uWzFdIDwgOTApIHtcbiAgICAgICAgeDEgPSAod2lkdGggLyAyKSAtICgod2lkdGggLyAyKSAqIE1hdGgudGFuKCg5MCAtIGRpcmVjdGlvblsxXSkgKiBNYXRoLlBJICogMiAvIDM2MCkgLSBoZWlnaHQgLyAyKSAqIE1hdGguc2luKDIgKiAoOTAgLSBkaXJlY3Rpb25bMV0pICogTWF0aC5QSSAqIDIgLyAzNjApIC8gMjtcbiAgICAgICAgeTIgPSBNYXRoLnRhbigoOTAgLSBkaXJlY3Rpb25bMV0pICogTWF0aC5QSSAqIDIgLyAzNjApICogeDE7XG4gICAgICAgIHgyID0gLXgxO1xuICAgICAgICB5MSA9IC15MjtcbiAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uWzFdID4gLTE4MCAmJiBkaXJlY3Rpb25bMV0gPCAtOTApIHtcbiAgICAgICAgeDEgPSAtKHdpZHRoIC8gMikgKyAoKHdpZHRoIC8gMikgKiBNYXRoLnRhbigoOTAgLSBkaXJlY3Rpb25bMV0pICogTWF0aC5QSSAqIDIgLyAzNjApIC0gaGVpZ2h0IC8gMikgKiBNYXRoLnNpbigyICogKDkwIC0gZGlyZWN0aW9uWzFdKSAqIE1hdGguUEkgKiAyIC8gMzYwKSAvIDI7XG4gICAgICAgIHkyID0gTWF0aC50YW4oKDkwIC0gZGlyZWN0aW9uWzFdKSAqIE1hdGguUEkgKiAyIC8gMzYwKSAqIHgxO1xuICAgICAgICB4MiA9IC14MTtcbiAgICAgICAgeTEgPSAteTI7XG4gICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvblsxXSA+IDkwICYmIGRpcmVjdGlvblsxXSA8IDE4MCkge1xuICAgICAgICB4MSA9ICh3aWR0aCAvIDIpICsgKC0od2lkdGggLyAyKSAqIE1hdGgudGFuKCg5MCAtIGRpcmVjdGlvblsxXSkgKiBNYXRoLlBJICogMiAvIDM2MCkgLSBoZWlnaHQgLyAyKSAqIE1hdGguc2luKDIgKiAoOTAgLSBkaXJlY3Rpb25bMV0pICogTWF0aC5QSSAqIDIgLyAzNjApIC8gMjtcbiAgICAgICAgeTIgPSBNYXRoLnRhbigoOTAgLSBkaXJlY3Rpb25bMV0pICogTWF0aC5QSSAqIDIgLyAzNjApICogeDE7XG4gICAgICAgIHgyID0gLXgxO1xuICAgICAgICB5MSA9IC15MjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHgxID0gLSh3aWR0aCAvIDIpIC0gKC0od2lkdGggLyAyKSAqIE1hdGgudGFuKCg5MCAtIGRpcmVjdGlvblsxXSkgKiBNYXRoLlBJICogMiAvIDM2MCkgLSBoZWlnaHQgLyAyKSAqIE1hdGguc2luKDIgKiAoOTAgLSBkaXJlY3Rpb25bMV0pICogTWF0aC5QSSAqIDIgLyAzNjApIC8gMjtcbiAgICAgICAgeTIgPSBNYXRoLnRhbigoOTAgLSBkaXJlY3Rpb25bMV0pICogTWF0aC5QSSAqIDIgLyAzNjApICogeDE7XG4gICAgICAgIHgyID0gLXgxO1xuICAgICAgICB5MSA9IC15MjtcbiAgICAgIH1cbiAgICAgIGNvb3JkaW5hdGUgPSBbeDEsIHkxLCB4MiwgeTJdO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiBjb29yZGluYXRlO1xuICB9XG5cbiAgZnVuY3Rpb24gbGluZWFyRWZmZWN0KHdpZHRoLCBoZWlnaHQsIGJnLCBjdHgpIHtcbiAgICBjb25zdCBwYXJhbSA9IGFuYWxpemVMaW5lYXIoYmcsIHdpZHRoLCBoZWlnaHQpO1xuICAgIGNvbnN0IGdyZCA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudChwYXJhbVswXSwgcGFyYW1bMV0sIHBhcmFtWzJdLCBwYXJhbVszXSk7XG4gICAgY29uc3QgY29udGVudCA9IGJnLm1hdGNoKC9saW5lYXItZ3JhZGllbnRcXCgoLispXFwpLylbMV07XG4gICAgY29uc3QgY29sb3JQZXIgPSBhbmFsaXplR3JhZChjb250ZW50LnN1YnN0cmluZyhjb250ZW50LmluZGV4T2YoJywnKSArIDEpKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbG9yUGVyLmNvbG9ycy5sZW5ndGg7IGkrKykge1xuICAgICAgZ3JkLmFkZENvbG9yU3RvcChjb2xvclBlci5wZXJjZW50c1tpXSwgY29sb3JQZXIuY29sb3JzW2ldKTtcbiAgICB9XG4gICAgY3R4LmZpbGxTdHlsZSA9IGdyZDtcbiAgICAvLyBjdHguZmlsbFJlY3QoLSh3aWR0aCAvIDIpLCAtKGhlaWdodCAvIDIpLCB3aWR0aCwgaGVpZ2h0KTtcbiAgfVxuXG4gIG1vZHVsZS5leHBvcnRzID0geyBhcGkgfTtcbn0oKSk7XG4iXX0=