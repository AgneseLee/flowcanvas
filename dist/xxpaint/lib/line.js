"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.insertVnodeIntoLine=void 0;var _layout=require("./layout"),_util=require("./util");function _createLine(t){var n=t.parent,i=(0,_util.formatPaddingMargin)(t.css),e=i.paddingLeft,o=i.marginLeft,a=i.paddingTop,d=i.marginTop,i=n.renderStyle.contentX,n=(0,_layout.getPreLayout)(t).y+(0,_layout.getPreLayout)(t).height,d={x:i,y:n,contentX:i+e+o,contentY:n+a+d},t={width:t.parent.processedLocation.width,height:t.processedLocation.height,paddingTop:t.css.paddingTop?t.css.paddingTop.toPx():0,paddingBottom:t.css.paddingBottom?t.css.paddingBottom.toPx():0,paddingLeft:t.css.paddingLeft?t.css.paddingLeft.toPx():0,paddingRight:t.css.paddingRight?t.css.paddingRight.toPx():0,marginLeft:t.css.marginLeft?t.css.marginLeft.toPx():0,marginRight:t.css.marginRight?t.css.marginRight.toPx():0,marginTop:t.css.marginTop?t.css.marginTop.toPx():0,marginBottom:t.css.marginBottom?t.css.marginBottom.toPx():0,children:[]};return Object.assign(t,d)}function _updateLineLayout(o){var t=o.children.reduce(function(t,n){var i=_getPreLayoutInLine(n,o),e=i.x;i.y;return e+i.width+(n.css.paddingLeft?n.css.paddingLeft.toPx():0)+(n.css.marginLeft?n.css.marginLeft.toPx():0)+n.processedLocation.width+t},0);o.width=Math.max(t,o.width);var n=o.children.reduce(function(t,n){var i=n.css.paddingTop?n.css.paddingTop.toPx():0,e=n.css.paddingBochildPaddingBottom?n.css.paddingBochildPaddingBottom.toPx():0,o=n.css.marginTop?n.css.marginTop.toPx():0,a=n.css.marginBottom?n.css.marginBottom.toPx():0,n=n.processedLocation.height;return{h:Math.max(n,t.h),pt:Math.max(i,t.pt),pb:Math.max(e,t.pb),mt:Math.max(o,t.mt),mb:Math.max(a,t.mb)}},{h:0,pt:0,pb:0,mt:0,mb:0}),i=n.h,e=n.pt,a=n.pb,t=n.mt,n=n.mb;o.paddingTop=e,o.paddingBottom=a,o.marginTop=t,o.marginBottom=n,o.height=i,_updateElementLayout(o)}function _getPreLayoutInLine(n,t){var i=t.children.findIndex(function(t){return t===n}),e=t.children[i-1];return i<0?(console.error("找不到行内元素"),{width:0,height:0,x:0,y:0}):0<i?{width:e.processedLocation.width,height:e.processedLocation.height,x:e.renderStyle.contentX,y:e.renderStyle.contentY}:{width:0,height:0,x:t&&_getContainerLineLayout(t).contentX,y:t&&_getContainerLineLayout(t).contentY}}function _getContainerLineLayout(t){t={width:(t=t||{renderStyles:{width:t.processedLocation.width,height:t.processedLocation.height,paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0,marginLeft:0,marginRight:0,marginTop:0,marginBottom:0},x:0,y:0,contentX:0,contentY:0}).width,height:t.height,x:t.x,y:t.y,paddingTop:t.paddingTop||0,paddingBottom:t.paddingBottom||0,paddingLeft:t.paddingLeft||0,paddingRight:t.paddingRight||0,marginLeft:t.marginLeft||0,marginRight:t.marginRight||0,marginTop:t.marginTop||0,marginBottom:t.marginBottom||0};return t.contentX=t.x+t.paddingLeft,t.contentY=t.y+t.paddingTop,t}function _updateElementLayout(a){a.children.forEach(function(t){var n=(0,_util.formatPaddingMargin)(t.css),i=n.paddingLeft,e=n.marginLeft,o=(n.paddingTop,n.marginTop,_getPreLayoutInLine(t,a).x+_getPreLayoutInLine(t,a).width),n=a.y,n={x:o,y:n,contentX:o+i+e,contentY:n+a.paddingTop+a.marginTop};t.renderStyle=n})}var insertVnodeIntoLine=function(t,n){if(n||0===t.parent.lines.length){var i=_createLine(t);return i.children.push(t),t.parent.lines.push(i),void _updateLineLayout(i)}0<t.parent.lines.length&&((i=t.parent.lines[t.parent.lines.length-1]).children.push(t),_updateLineLayout(i))};exports.insertVnodeIntoLine=insertVnodeIntoLine;