"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.xmlToVnode=exports.initVnodeTree=exports.connectChildren=exports.createVnode=void 0;var _util=require("./util");function ownKeys(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var createVnode=function(e){var t={text:e.text||"",url:e.url||"",type:e.type,css:e.css||{},islines:!1,renderStyle:{x:0,y:0,contentX:0,contentY:0},children:e.children||[],lines:[],parent:null,pre:null,next:null};return Object.assign(e,t)};exports.createVnode=createVnode;var connectChildren=function n(r){var i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];hasChildren(r)&&_getChildren(r).forEach(function(e,t){"false"===e.attributes["p-if"]||(e.css=_inheritStyle(r,e),_setParent(e,r,i),i=!1,_setSibling(e,_getChildren(r)[t-1],_getChildren(r)[t+1]),n(e,i))})};exports.connectChildren=connectChildren;var initVnodeTree=function(e){var t=[];if(null!=e){var n=[];for(n.unshift(e);0!=n.length;){var r=n.shift(),r=createVnode(r);t.push(r);for(var i=r.children||[],o=0;o<i.length;o++)n.push(i[o])}}return connectChildren(e),console.log("vnodeTree is: ",e),e};function hasChildren(e){return!(!Array.isArray(e.children)||!e.children.length)}function _getChildren(e){return hasChildren(e)?e.children:[]}function _delNode(e,t){var n=e.children.findIndex(function(e){return e===t});e.children.splice(n,1)}function _setParent(e,t,n){e.parent=n?null:t}function _setSibling(e,t,n){e.pre=t||null,e.next=n||null}function _inheritStyle(e,t){for(var n=JSON.parse(JSON.stringify(e.css)),r=["height","width","margin","padding","marginTop","marginLeft","marginBottom","marginRight","paddingLeft","paddingRight","paddingTop","paddingBottom"],i=0,o=Object.keys(n);i<o.length;i++){var c=o[i];r.includes(c)&&delete n[c]}return _objectSpread(_objectSpread({},n),t.css)}function _formatVnode2(e,n){(0,_util.deepFirstSearch)(e,function(e){var t;e.attributes.class&&(t=e.attributes.class.split(" ").reduce(function(e,t){return _objectSpread(_objectSpread({},e),n[t])},{}),e.css=t),"img"===e.attributes.class&&e.attributes.src&&(e.url=e.attributes.src),"text"===e.name&&(e.text=e.content),e.type=e.name,createVnode(e)}),connectChildren(e)}function _formatVnode(e,n){(0,_util.deepFirstSearch)(e,function(e){var t;e.attributes.class&&(t=e.attributes.class.split(" ").reduce(function(e,t){return _objectSpread(_objectSpread({},e),n[t])},{}),e.css=t),"img"===e.attributes.class&&e.attributes.src&&(e.url=e.attributes.src),"text"===e.name&&(e.text=e.children[0],e.children.length=0),e.type=e.name,createVnode(e)}),connectChildren(e)}exports.initVnodeTree=initVnodeTree;var xmlToVnode=function(e,t){return _formatVnode(e,t),e};exports.xmlToVnode=xmlToVnode;