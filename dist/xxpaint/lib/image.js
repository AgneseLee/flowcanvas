"use strict";var _downloader=_interopRequireDefault(require("./downloader"));function _interopRequireDefault(r){return r&&r.__esModule?r:{default:r}}function _createForOfIteratorHelper(r,e){var n;if("undefined"==typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(n=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){n&&(r=n);var t=0,e=function(){};return{s:e,n:function(){return t>=r.length?{done:!0}:{done:!1,value:r[t++]}},e:function(r){throw r},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){n=r[Symbol.iterator]()},n:function(){var r=n.next();return a=r.done,r},e:function(r){i=!0,o=r},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(r,e){if(r){if("string"==typeof r)return _arrayLikeToArray(r,e);var n=Object.prototype.toString.call(r).slice(8,-1);return"Map"===(n="Object"===n&&r.constructor?r.constructor.name:n)||"Set"===n?Array.from(r):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(r,e):void 0}}function _arrayLikeToArray(r,e){(null==e||e>r.length)&&(e=r.length);for(var n=0,t=new Array(e);n<e;n++)t[n]=r[n];return t}var downloader=new _downloader.default;function downloadImages(e){return new Promise(function(o,r){var a=0,i=0,u=e;!function r(e){if(e&&(e&&"image"===e.type&&e.url&&(a++,downloader.download(e.url).then(function(r){e.url=r,wx.getImageInfo({src:e.url,success:function(r){e.sWidth=r.width,e.sHeight=r.height},fail:function(r){e.url="",console.error("getImageInfo ".concat(e.url," failed, ").concat(JSON.stringify(r)))},complete:function(){a===++i&&o(u)}})},function(){a===++i&&o(u)})),e.children&&e.children.length)){var n,t=_createForOfIteratorHelper(e.children);try{for(t.s();!(n=t.n()).done;)r(n.value)}catch(r){t.e(r)}finally{t.f()}}}(u.children[0]),0===a&&o(u)})}module.exports.downloadImages=downloadImages;