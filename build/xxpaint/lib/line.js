"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.insertVnodeIntoLine = void 0;
var layout_1 = require("./layout");
var util_1 = require("./util");
function _createLine(node) {
    var parent = node.parent;
    var _a = util_1.formatPaddingMargin(node.css), paddingLeft = _a.paddingLeft, marginLeft = _a.marginLeft, paddingTop = _a.paddingTop, marginTop = _a.marginTop;
    var x = parent.renderStyle.contentX;
    var y = layout_1.getPreLayout(node).y + layout_1.getPreLayout(node).height;
    var renderStyle = {
        x: x,
        y: y,
        contentX: x + paddingLeft + marginLeft,
        contentY: y + paddingTop + marginTop,
    };
    var line = {
        width: node.parent.processedLocation.width,
        height: node.processedLocation.height,
        paddingTop: node.css.paddingTop ? node.css.paddingTop.toPx() : 0,
        paddingBottom: node.css.paddingBottom ? node.css.paddingBottom.toPx() : 0,
        paddingLeft: node.css.paddingLeft ? node.css.paddingLeft.toPx() : 0,
        paddingRight: node.css.paddingRight ? node.css.paddingRight.toPx() : 0,
        marginLeft: node.css.marginLeft ? node.css.marginLeft.toPx() : 0,
        marginRight: node.css.marginRight ? node.css.marginRight.toPx() : 0,
        marginTop: node.css.marginTop ? node.css.marginTop.toPx() : 0,
        marginBottom: node.css.marginBottom ? node.css.marginBottom.toPx() : 0,
        children: [],
    };
    return Object.assign(line, renderStyle);
}
function _updateLineLayout(line) {
    var widthSum = line.children.reduce(function (pre, next) {
        var _a = _getPreLayoutInLine(next, line), x = _a.x, y = _a.y, preW = _a.width;
        var childPaddingLeft = next.css.paddingLeft ? next.css.paddingLeft.toPx() : 0;
        var childMarginLeft = next.css.marginLeft ? next.css.marginLeft.toPx() : 0;
        var currW = next.processedLocation.width;
        var nextStartX = x + preW + childPaddingLeft + childMarginLeft + currW;
        return nextStartX + pre;
    }, 0);
    line.width = Math.max(widthSum, line.width);
    var updatedLayout = line.children.reduce(function (pre, next) {
        var childPaddingTop = next.css.paddingTop ? next.css.paddingTop.toPx() : 0;
        var childPaddingBottom = next.css.paddingBochildPaddingBottom ? next.css.paddingBochildPaddingBottom.toPx() : 0;
        var childMarginTop = next.css.marginTop ? next.css.marginTop.toPx() : 0;
        var childMarginBottom = next.css.marginBottom ? next.css.marginBottom.toPx() : 0;
        var currH = next.processedLocation.height;
        return {
            h: Math.max(currH, pre.h),
            pt: Math.max(childPaddingTop, pre.pt),
            pb: Math.max(childPaddingBottom, pre.pb),
            mt: Math.max(childMarginTop, pre.mt),
            mb: Math.max(childMarginBottom, pre.mb),
        };
    }, { h: 0, pt: 0, pb: 0, mt: 0, mb: 0 });
    var h = updatedLayout.h, pt = updatedLayout.pt, pb = updatedLayout.pb, mt = updatedLayout.mt, mb = updatedLayout.mb;
    line.paddingTop = pt;
    line.paddingBottom = pb;
    line.marginTop = mt;
    line.marginBottom = mb;
    line.height = h;
    _updateElementLayout(line);
}
function _getPreLayoutInLine(targetNode, line) {
    var idx = line.children.findIndex(function (x) { return x === targetNode; });
    var preEleInLine = line.children[idx - 1];
    if (idx < 0) {
        console.error('找不到行内元素');
        return {
            width: 0,
            height: 0,
            x: 0,
            y: 0,
        };
    }
    if (idx > 0) {
        return {
            width: preEleInLine.processedLocation.width,
            height: preEleInLine.processedLocation.height,
            x: preEleInLine.renderStyle.contentX,
            y: preEleInLine.renderStyle.contentY,
        };
    }
    return {
        width: 0,
        height: 0,
        x: line && _getContainerLineLayout(line).contentX,
        y: line && _getContainerLineLayout(line).contentY,
    };
}
function _getContainerLineLayout(container) {
    if (!container) {
        if (!container) {
            debugger;
        }
        container = {
            renderStyles: {
                width: container.processedLocation.width,
                height: container.processedLocation.height,
                paddingTop: 0,
                paddingBottom: 0,
                paddingLeft: 0,
                paddingRight: 0,
                marginLeft: 0,
                marginRight: 0,
                marginTop: 0,
                marginBottom: 0,
            },
            x: 0,
            y: 0,
            contentX: 0,
            contentY: 0,
        };
    }
    var res = {
        width: container.width,
        height: container.height,
        x: container.x,
        y: container.y,
        paddingTop: container.paddingTop ? container.paddingTop : 0,
        paddingBottom: container.paddingBottom ? container.paddingBottom : 0,
        paddingLeft: container.paddingLeft ? container.paddingLeft : 0,
        paddingRight: container.paddingRight ? container.paddingRight : 0,
        marginLeft: container.marginLeft ? container.marginLeft : 0,
        marginRight: container.marginRight ? container.marginRight : 0,
        marginTop: container.marginTop ? container.marginTop : 0,
        marginBottom: container.marginBottom ? container.marginBottom : 0,
    };
    res.contentX = res.x + res.paddingLeft;
    res.contentY = res.y + res.paddingTop;
    return res;
}
function _updateElementLayout(line) {
    line.children.forEach(function (el) {
        var _a = util_1.formatPaddingMargin(el.css), paddingLeft = _a.paddingLeft, marginLeft = _a.marginLeft, paddingTop = _a.paddingTop, marginTop = _a.marginTop;
        var x = _getPreLayoutInLine(el, line).x + _getPreLayoutInLine(el, line).width;
        var y = line.y;
        var renderStyle = {
            x: x,
            y: y,
            contentX: x + paddingLeft + marginLeft,
            contentY: y + line.paddingTop + line.marginTop,
        };
        el.renderStyle = renderStyle;
    });
}
var insertVnodeIntoLine = function (vnode, changeLine) {
    if (changeLine || vnode.parent.lines.length === 0) {
        var newLine = _createLine(vnode);
        newLine.children.push(vnode);
        vnode.parent.lines.push(newLine);
        _updateLineLayout(newLine);
        return;
    }
    if (vnode.parent.lines.length > 0) {
        var currLine = vnode.parent.lines[vnode.parent.lines.length - 1];
        currLine.children.push(vnode);
        _updateLineLayout(currLine);
    }
};
exports.insertVnodeIntoLine = insertVnodeIntoLine;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGluZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy94eHBhaW50L2xpYi9saW5lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLG1DQUF3QztBQUN4QywrQkFBNkM7QUFNN0MsU0FBUyxXQUFXLENBQUMsSUFBSTtJQUN2QixJQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3JCLElBQUEsS0FBcUQsMEJBQW1CLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFoRixXQUFXLGlCQUFBLEVBQUUsVUFBVSxnQkFBQSxFQUFFLFVBQVUsZ0JBQUEsRUFBRSxTQUFTLGVBQWtDLENBQUM7SUFHekYsSUFBTSxDQUFDLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUM7SUFDdEMsSUFBTSxDQUFDLEdBQUcscUJBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcscUJBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUM7SUFFM0QsSUFBTSxXQUFXLEdBQUc7UUFDbEIsQ0FBQyxHQUFBO1FBQ0QsQ0FBQyxHQUFBO1FBQ0QsUUFBUSxFQUFFLENBQUMsR0FBRyxXQUFXLEdBQUcsVUFBVTtRQUN0QyxRQUFRLEVBQUUsQ0FBQyxHQUFHLFVBQVUsR0FBRyxTQUFTO0tBQ3JDLENBQUM7SUFDRixJQUFNLElBQUksR0FBRztRQUNYLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEtBQUs7UUFDMUMsTUFBTSxFQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNO1FBR3JDLFVBQVUsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDaEUsYUFBYSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUMs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Q0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNuRSxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM5QixpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztLQUM3QjtBQUNILENBQUMsQ0FBQztBQWRXLFFBQUEsbUJBQW1CLHVCQWM5QiIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlICovXG5pbXBvcnQgeyBnZXRQcmVMYXlvdXQgfSBmcm9tICcuL2xheW91dCc7XG5pbXBvcnQgeyBmb3JtYXRQYWRkaW5nTWFyZ2luIH0gZnJvbSAnLi91dGlsJztcblxuLyoqXG4gKiDliJvlu7rooYzlr7nosaFcbiAqIEBwYXJhbSB7b2JqZWN0fSBub2RlIOiiq+aPkuWFpeihjOS4reeahOafkOS4quiKgueCuVxuICovXG5mdW5jdGlvbiBfY3JlYXRlTGluZShub2RlKSB7XG4gIGNvbnN0IHBhcmVudCA9IG5vZGUucGFyZW50O1xuICBjb25zdCB7IHBhZGRpbmdMZWZ0LCBtYXJnaW5MZWZ0LCBwYWRkaW5nVG9wLCBtYXJnaW5Ub3AgfSA9IGZvcm1hdFBhZGRpbmdNYXJnaW4obm9kZS5jc3MpO1xuXG4gIC8vIOaNouihjOaXtiwgeTrlj6DliqBwcmXlhYTlvJ/oioLngrnlnZDmoIcsIHg65Y+g5Yqg54i26IqC54K55Z2Q5qCHXG4gIGNvbnN0IHggPSBwYXJlbnQucmVuZGVyU3R5bGUuY29udGVudFg7XG4gIGNvbnN0IHkgPSBnZXRQcmVMYXlvdXQobm9kZSkueSArIGdldFByZUxheW91dChub2RlKS5oZWlnaHQ7XG4gIC8vIGRlYnVnZ2VyXG4gIGNvbnN0IHJlbmRlclN0eWxlID0ge1xuICAgIHgsXG4gICAgeSxcbiAgICBjb250ZW50WDogeCArIHBhZGRpbmdMZWZ0ICsgbWFyZ2luTGVmdCxcbiAgICBjb250ZW50WTogeSArIHBhZGRpbmdUb3AgKyBtYXJnaW5Ub3AsXG4gIH07XG4gIGNvbnN0IGxpbmUgPSB7XG4gICAgd2lkdGg6IG5vZGUucGFyZW50LnByb2Nlc3NlZExvY2F0aW9uLndpZHRoLCAvLyDooYzlrr3nlLHooYzlhoXlhYPntKDlrr3luqbmgLvlkozlhrPlrppcbiAgICBoZWlnaHQ6IG5vZGUucHJvY2Vzc2VkTG9jYXRpb24uaGVpZ2h0LCAvLyDooYzpq5jnlLHooYzlhoXmnIDpq5jlhYPntKDlhrPlrppcbiAgICAvLyB4OiBub2RlLnJlbmRlclN0eWxlLngsXG4gICAgLy8geTogbm9kZS5yZW5kZXJTdHlsZS55LFxuICAgIHBhZGRpbmdUb3A6IG5vZGUuY3NzLnBhZGRpbmdUb3AgPyBub2RlLmNzcy5wYWRkaW5nVG9wLnRvUHgoKSA6IDAsXG4gICAgcGFkZGluZ0JvdHRvbTogbm9kZS5jc3MucGFkZGluZ0JvdHRvbSA/IG5vZGUuY3NzLnBhZGRpbmdCb3R0b20udG9QeCgpIDogMCxcbiAgICBwYWRkaW5nTGVmdDogbm9kZS5jc3MucGFkZGluZ0xlZnQgPyBub2RlLmNzcy5wYWRkaW5nTGVmdC50b1B4KCkgOiAwLFxuICAgIHBhZGRpbmdSaWdodDogbm9kZS5jc3MucGFkZGluZ1JpZ2h0ID8gbm9kZS5jc3MucGFkZGluZ1JpZ2h0LnRvUHgoKSA6IDAsXG4gICAgbWFyZ2luTGVmdDogbm9kZS5jc3MubWFyZ2luTGVmdCA/IG5vZGUuY3NzLm1hcmdpbkxlZnQudG9QeCgpIDogMCxcbiAgICBtYXJnaW5SaWdodDogbm9kZS5jc3MubWFyZ2luUmlnaHQgPyBub2RlLmNzcy5tYXJnaW5SaWdodC50b1B4KCkgOiAwLFxuICAgIG1hcmdpblRvcDogbm9kZS5jc3MubWFyZ2luVG9wID8gbm9kZS5jc3MubWFyZ2luVG9wLnRvUHgoKSA6IDAsXG4gICAgbWFyZ2luQm90dG9tOiBub2RlLmNzcy5tYXJnaW5Cb3R0b20gPyBub2RlLmNzcy5tYXJnaW5Cb3R0b20udG9QeCgpIDogMCxcbiAgICBjaGlsZHJlbjogW10sIC8vIOihjOWGheiKgueCuVxuICB9O1xuICByZXR1cm4gT2JqZWN0LmFzc2lnbihsaW5lLCByZW5kZXJTdHlsZSk7XG59XG5cbi8qKlxuICog5pu05paw6KGM55qE5a696auYXG4gKiBAcGFyYW0ge29iamVjdH0gbGluZVxuICovXG5mdW5jdGlvbiBfdXBkYXRlTGluZUxheW91dChsaW5lKSB7XG4gIC8vIOWuveW6plxuICBjb25zdCB3aWR0aFN1bSA9IGxpbmUuY2hpbGRyZW4ucmVkdWNlKChwcmUsIG5leHQpID0+IHtcbiAgICAvLyBjb25zdCB7IHBhZGRpbmdMZWZ0LCBwYWRkaW5nUmlnaHQsIHBhZGRpbmdUb3AsIHBhZGRpbmdCb3R0b20sIG1hcmdpblRvcCwgbWFyZ2luQm90dG9tLCBtYXJnaW5MZWZ0LCBtYXJnaW5SaWdodCB9ID0gbmV4dC5jc3NcbiAgICBjb25zdCB7IHgsIHksIHdpZHRoOiBwcmVXIH0gPSBfZ2V0UHJlTGF5b3V0SW5MaW5lKG5leHQsIGxpbmUpO1xuICAgIGNvbnN0IGNoaWxkUGFkZGluZ0xlZnQgPSBuZXh0LmNzcy5wYWRkaW5nTGVmdCA/IG5leHQuY3NzLnBhZGRpbmdMZWZ0LnRvUHgoKSA6IDA7XG4gICAgY29uc3QgY2hpbGRNYXJnaW5MZWZ0ID0gbmV4dC5jc3MubWFyZ2luTGVmdCA/IG5leHQuY3NzLm1hcmdpbkxlZnQudG9QeCgpIDogMDtcbiAgICBjb25zdCBjdXJyVyA9IG5leHQucHJvY2Vzc2VkTG9jYXRpb24ud2lkdGg7XG4gICAgY29uc3QgbmV4dFN0YXJ0WCA9IHggKyBwcmVXICsgY2hpbGRQYWRkaW5nTGVmdCArIGNoaWxkTWFyZ2luTGVmdCArIGN1cnJXO1xuICAgIHJldHVybiBuZXh0U3RhcnRYICsgcHJlO1xuICB9LCAwKTtcbiAgbGluZS53aWR0aCA9IE1hdGgubWF4KHdpZHRoU3VtLCBsaW5lLndpZHRoKTtcblxuICAvLyDpq5jluqYscGFkZGluZyxtYXJnaW5cbiAgY29uc3QgdXBkYXRlZExheW91dCA9IGxpbmUuY2hpbGRyZW4ucmVkdWNlKChwcmUsIG5leHQpID0+IHtcbiAgICBjb25zdCBjaGlsZFBhZGRpbmdUb3AgPSBuZXh0LmNzcy5wYWRkaW5nVG9wID8gbmV4dC5jc3MucGFkZGluZ1RvcC50b1B4KCkgOiAwO1xuICAgIGNvbnN0IGNoaWxkUGFkZGluZ0JvdHRvbSA9IG5leHQuY3NzLnBhZGRpbmdCb2NoaWxkUGFkZGluZ0JvdHRvbSA/IG5leHQuY3NzLnBhZGRpbmdCb2NoaWxkUGFkZGluZ0JvdHRvbS50b1B4KCkgOiAwO1xuICAgIGNvbnN0IGNoaWxkTWFyZ2luVG9wID0gbmV4dC5jc3MubWFyZ2luVG9wID8gbmV4dC5jc3MubWFyZ2luVG9wLnRvUHgoKSA6IDA7XG4gICAgY29uc3QgY2hpbGRNYXJnaW5Cb3R0b20gPSBuZXh0LmNzcy5tYXJnaW5Cb3R0b20gPyBuZXh0LmNzcy5tYXJnaW5Cb3R0b20udG9QeCgpIDogMDtcbiAgICBjb25zdCBjdXJySCA9IG5leHQucHJvY2Vzc2VkTG9jYXRpb24uaGVpZ2h0O1xuICAgIC8vIGNvbnN0IG5leHRTdGFydFkgPSBjaGlsZFBhZGRpbmdUb3AgKyBjaGlsZE1hcmdpblRvcCArIGN1cnJIXG4gICAgcmV0dXJuIHtcbiAgICAgIGg6IE1hdGgubWF4KGN1cnJILCBwcmUuaCksXG4gICAgICBwdDogTWF0aC5tYXgoY2hpbGRQYWRkaW5nVG9wLCBwcmUucHQpLFxuICAgICAgcGI6IE1hdGgubWF4KGNoaWxkUGFkZGluZ0JvdHRvbSwgcHJlLnBiKSxcbiAgICAgIG10OiBNYXRoLm1heChjaGlsZE1hcmdpblRvcCwgcHJlLm10KSxcbiAgICAgIG1iOiBNYXRoLm1heChjaGlsZE1hcmdpbkJvdHRvbSwgcHJlLm1iKSxcbiAgICB9O1xuICB9LCB7IGg6IDAsIHB0OiAwLCBwYjogMCwgbXQ6IDAsIG1iOiAwIH0pO1xuICBjb25zdCB7IGgsIHB0LCBwYiwgbXQsIG1iIH0gPSB1cGRhdGVkTGF5b3V0O1xuICBsaW5lLnBhZGRpbmdUb3AgPSBwdDtcbiAgbGluZS5wYWRkaW5nQm90dG9tID0gcGI7XG4gIGxpbmUubWFyZ2luVG9wID0gbXQ7XG4gIGxpbmUubWFyZ2luQm90dG9tID0gbWI7XG4gIGxpbmUuaGVpZ2h0ID0gaDtcbiAgLy8gZGVidWdnZXJcbiAgLy8g5pu05paw5a6M6KGM5bGe5oCn77yM5pu05paw6KGM5YaF5YWD57Sg5biD5bGAXG4gIF91cGRhdGVFbGVtZW50TGF5b3V0KGxpbmUpO1xufVxuXG5mdW5jdGlvbiBfZ2V0UHJlTGF5b3V0SW5MaW5lKHRhcmdldE5vZGUsIGxpbmUpIHtcbiAgY29uc3QgaWR4ID0gbGluZS5jaGlsZHJlbi5maW5kSW5kZXgoKHgpID0+IHsgcmV0dXJuIHggPT09IHRhcmdldE5vZGU7IH0pO1xuICBjb25zdCBwcmVFbGVJbkxpbmUgPSBsaW5lLmNoaWxkcmVuW2lkeCAtIDFdO1xuICBpZiAoaWR4IDwgMCkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+aJvuS4jeWIsOihjOWGheWFg+e0oCcpO1xuICAgIHJldHVybiB7XG4gICAgICB3aWR0aDogMCxcbiAgICAgIGhlaWdodDogMCxcbiAgICAgIHg6IDAsXG4gICAgICB5OiAwLFxuICAgIH07XG4gIH1cbiAgaWYgKGlkeCA+IDApIHtcbiAgICByZXR1cm4ge1xuICAgICAgd2lkdGg6IHByZUVsZUluTGluZS5wcm9jZXNzZWRMb2NhdGlvbi53aWR0aCxcbiAgICAgIGhlaWdodDogcHJlRWxlSW5MaW5lLnByb2Nlc3NlZExvY2F0aW9uLmhlaWdodCxcbiAgICAgIHg6IHByZUVsZUluTGluZS5yZW5kZXJTdHlsZS5jb250ZW50WCxcbiAgICAgIHk6IHByZUVsZUluTGluZS5yZW5kZXJTdHlsZS5jb250ZW50WSxcbiAgICB9O1xuICAgIC8vIOWmguaenOayoeacieWJjeS4gOS4quaIluiAheWJjemdoueahOmDveS4jeWcqOaWh+aho+a1geS4re+8jOiOt+WPluaJgOWcqOihjOeahFxuICB9XG4gIHJldHVybiB7XG4gICAgd2lkdGg6IDAsXG4gICAgaGVpZ2h0OiAwLFxuICAgIHg6IGxpbmUgJiYgX2dldENvbnRhaW5lckxpbmVMYXlvdXQobGluZSkuY29udGVudFgsXG4gICAgeTogbGluZSAmJiBfZ2V0Q29udGFpbmVyTGluZUxheW91dChsaW5lKS5jb250ZW50WSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gX2dldENvbnRhaW5lckxpbmVMYXlvdXQoY29udGFpbmVyKSB7XG4gIC8vIGRlYnVnZ2VyXG4gIGlmICghY29udGFpbmVyKSB7XG4gICAgLy8gcm9vdFxuICAgIGlmICghY29udGFpbmVyKSB7XG4gICAgICBkZWJ1Z2dlcjtcbiAgICB9XG4gICAgY29udGFpbmVyID0ge1xuICAgICAgcmVuZGVyU3R5bGVzOiB7XG4gICAgICAgIHdpZHRoOiBjb250YWluZXIucHJvY2Vzc2VkTG9jYXRpb24ud2lkdGgsXG4gICAgICAgIGhlaWdodDogY29udGFpbmVyLnByb2Nlc3NlZExvY2F0aW9uLmhlaWdodCxcbiAgICAgICAgcGFkZGluZ1RvcDogMCxcbiAgICAgICAgcGFkZGluZ0JvdHRvbTogMCxcbiAgICAgICAgcGFkZGluZ0xlZnQ6IDAsXG4gICAgICAgIHBhZGRpbmdSaWdodDogMCxcbiAgICAgICAgbWFyZ2luTGVmdDogMCxcbiAgICAgICAgbWFyZ2luUmlnaHQ6IDAsXG4gICAgICAgIG1hcmdpblRvcDogMCxcbiAgICAgICAgbWFyZ2luQm90dG9tOiAwLFxuICAgICAgICAvLyBjb250ZW50V2lkdGg6IGNvbnRhaW5lci5wcm9jZXNzZWRMb2NhdGlvbi53aWR0aCxcbiAgICAgICAgLy8gY29udGVudEhlaWdodDogY29udGFpbmVyLnByb2Nlc3NlZExvY2F0aW9uLmhlaWdodFxuICAgICAgfSxcbiAgICAgIHg6IDAsXG4gICAgICB5OiAwLFxuICAgICAgY29udGVudFg6IDAsXG4gICAgICBjb250ZW50WTogMCxcbiAgICB9O1xuICB9XG4gIGNvbnN0IHJlcyA9IHtcbiAgICB3aWR0aDogY29udGFpbmVyLndpZHRoLFxuICAgIGhlaWdodDogY29udGFpbmVyLmhlaWdodCxcbiAgICB4OiBjb250YWluZXIueCxcbiAgICB5OiBjb250YWluZXIueSxcbiAgICBwYWRkaW5nVG9wOiBjb250YWluZXIucGFkZGluZ1RvcCA/IGNvbnRhaW5lci5wYWRkaW5nVG9wIDogMCxcbiAgICBwYWRkaW5nQm90dG9tOiBjb250YWluZXIucGFkZGluZ0JvdHRvbSA/IGNvbnRhaW5lci5wYWRkaW5nQm90dG9tIDogMCxcbiAgICBwYWRkaW5nTGVmdDogY29udGFpbmVyLnBhZGRpbmdMZWZ0ID8gY29udGFpbmVyLnBhZGRpbmdMZWZ0IDogMCxcbiAgICBwYWRkaW5nUmlnaHQ6IGNvbnRhaW5lci5wYWRkaW5nUmlnaHQgPyBjb250YWluZXIucGFkZGluZ1JpZ2h0IDogMCxcbiAgICBtYXJnaW5MZWZ0OiBjb250YWluZXIubWFyZ2luTGVmdCA/IGNvbnRhaW5lci5tYXJnaW5MZWZ0IDogMCxcbiAgICBtYXJnaW5SaWdodDogY29udGFpbmVyLm1hcmdpblJpZ2h0ID8gY29udGFpbmVyLm1hcmdpblJpZ2h0IDogMCxcbiAgICBtYXJnaW5Ub3A6IGNvbnRhaW5lci5tYXJnaW5Ub3AgPyBjb250YWluZXIubWFyZ2luVG9wIDogMCxcbiAgICBtYXJnaW5Cb3R0b206IGNvbnRhaW5lci5tYXJnaW5Cb3R0b20gPyBjb250YWluZXIubWFyZ2luQm90dG9tIDogMCxcbiAgfTtcbiAgcmVzLmNvbnRlbnRYID0gcmVzLnggKyByZXMucGFkZGluZ0xlZnQ7XG4gIHJlcy5jb250ZW50WSA9IHJlcy55ICsgcmVzLnBhZGRpbmdUb3A7XG4gIHJldHVybiByZXM7XG59XG5cbi8qKlxuICog5pu05paw6KGM5Lit5YWD57Sg5L2N572uXG4gKiBAcGFyYW0ge29iamVjdH0gbGluZVxuICovXG5mdW5jdGlvbiBfdXBkYXRlRWxlbWVudExheW91dChsaW5lKSB7XG4gIGxpbmUuY2hpbGRyZW4uZm9yRWFjaCgoZWwpID0+IHtcbiAgICBjb25zdCB7IHBhZGRpbmdMZWZ0LCBtYXJnaW5MZWZ0LCBwYWRkaW5nVG9wLCBtYXJnaW5Ub3AgfSA9IGZvcm1hdFBhZGRpbmdNYXJnaW4oZWwuY3NzKTtcbiAgICBjb25zdCB4ID0gX2dldFByZUxheW91dEluTGluZShlbCwgbGluZSkueCArIF9nZXRQcmVMYXlvdXRJbkxpbmUoZWwsIGxpbmUpLndpZHRoO1xuICAgIGNvbnN0IHkgPSBsaW5lLnk7XG4gICAgY29uc3QgcmVuZGVyU3R5bGUgPSB7XG4gICAgICB4LFxuICAgICAgeSxcbiAgICAgIGNvbnRlbnRYOiB4ICsgcGFkZGluZ0xlZnQgKyBtYXJnaW5MZWZ0LFxuICAgICAgY29udGVudFk6IHkgKyBsaW5lLnBhZGRpbmdUb3AgKyBsaW5lLm1hcmdpblRvcCxcbiAgICB9O1xuICAgIC8vIGVsLmxpbmVSZW5kZXIgPSByZW5kZXJTdHlsZVxuICAgIGVsLnJlbmRlclN0eWxlID0gcmVuZGVyU3R5bGU7XG4gIH0pO1xufVxuXG4vKipcbiAqIOaKiuiKgueCueaPkuWFpeihjFxuICogQHBhcmFtIHtvYmplY3R9IHZub2RlXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGNoYW5nZUxpbmUg6K+l5YWD57Sg5piv5ZCm5o2i6KGMXG4gKi9cbmV4cG9ydCBjb25zdCBpbnNlcnRWbm9kZUludG9MaW5lID0gKHZub2RlLCBjaGFuZ2VMaW5lKSA9PiB7XG4gIGlmIChjaGFuZ2VMaW5lIHx8IHZub2RlLnBhcmVudC5saW5lcy5sZW5ndGggPT09IDApIHtcbiAgICBjb25zdCBuZXdMaW5lID0gX2NyZWF0ZUxpbmUodm5vZGUpO1xuICAgIC8vIGRlYnVnZ2VyXG4gICAgbmV3TGluZS5jaGlsZHJlbi5wdXNoKHZub2RlKTtcbiAgICB2bm9kZS5wYXJlbnQubGluZXMucHVzaChuZXdMaW5lKTtcbiAgICBfdXBkYXRlTGluZUxheW91dChuZXdMaW5lKTtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKHZub2RlLnBhcmVudC5saW5lcy5sZW5ndGggPiAwKSB7XG4gICAgY29uc3QgY3VyckxpbmUgPSB2bm9kZS5wYXJlbnQubGluZXNbdm5vZGUucGFyZW50LmxpbmVzLmxlbmd0aCAtIDFdO1xuICAgIGN1cnJMaW5lLmNoaWxkcmVuLnB1c2godm5vZGUpO1xuICAgIF91cGRhdGVMaW5lTGF5b3V0KGN1cnJMaW5lKTtcbiAgfVxufTtcbiJdfQ==