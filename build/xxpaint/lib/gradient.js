"use strict";
!(function () {
    var api = {
        isGradient: function (bg) {
            if (bg && (bg.startsWith('linear') || bg.startsWith('radial'))) {
                return true;
            }
            return false;
        },
        doGradient: function (bg, width, height, ctx) {
            if (bg.startsWith('linear')) {
                linearEffect(width, height, bg, ctx);
            }
            else if (bg.startsWith('radial')) {
                radialEffect(width, height, bg, ctx);
            }
        },
    };
    function analizeGrad(string) {
        var colorPercents = string.substring(0, string.length - 1).split('%,');
        var colors = [];
        var percents = [];
        for (var _i = 0, colorPercents_1 = colorPercents; _i < colorPercents_1.length; _i++) {
            var colorPercent = colorPercents_1[_i];
            colors.push(colorPercent.substring(0, colorPercent.lastIndexOf(' ')).trim());
            percents.push(colorPercent.substring(colorPercent.lastIndexOf(' '), colorPercent.length) / 100);
        }
        return { colors: colors, percents: percents };
    }
    function radialEffect(width, height, bg, ctx) {
        var colorPer = analizeGrad(bg.match(/radial-gradient\((.+)\)/)[1]);
        var grd = ctx.createCircularGradient(0, 0, width < height ? height / 2 : width / 2);
        for (var i = 0; i < colorPer.colors.length; i++) {
            grd.addColorStop(colorPer.percents[i], colorPer.colors[i]);
        }
        ctx.fillStyle = grd;
    }
    function analizeLinear(bg, width, height) {
        var direction = bg.match(/([-]?\d{1,3})deg/);
        var dir = direction && direction[1] ? parseFloat(direction[1]) : 0;
        var coordinate;
        switch (dir) {
            case 0:
                coordinate = [0, -height / 2, 0, height / 2];
                break;
            case 90:
                coordinate = [width / 2, 0, -width / 2, 0];
                break;
            case -90:
                coordinate = [-width / 2, 0, width / 2, 0];
                break;
            case 180:
                coordinate = [0, height / 2, 0, -height / 2];
                break;
            case -180:
                coordinate = [0, -height / 2, 0, height / 2];
                break;
            default:
                var x1 = 0;
                var y1 = 0;
                var x2 = 0;
                var y2 = 0;
                if (direction[1] > 0 && direction[1] < 90) {
                    x1 = (width / 2) - ((width / 2) * Math.tan((90 - direction[1]) * Math.PI * 2 / 360) - height / 2) * Math.sin(2 * (90 - direction[1]) * Math.PI * 2 / 360) / 2;
                    y2 = Math.tan((90 - direction[1]) * Math.PI * 2 / 360) * x1;
                    x2 = -x1;
                    y1 = -y2;
                }
                else if (direction[1] > -180 && direction[1] < -90) {
                    x1 = -(width / 2) + ((width / 2) * Math.tan((90 - direction[1]) * Math.PI * 2 / 360) - height / 2) * Math.sin(2 * (90 - direction[1]) * Math.PI * 2 / 360) / 2;
                    y2 = Math.tan((90 - direction[1]) * Math.PI * 2 / 360) * x1;
                    x2 = -x1;
                    y1 = -y2;
                }
                else if (direction[1] > 90 && direction[1] < 180) {
                    x1 = (width / 2) + (-(width / 2) * Math.tan((90 - direction[1]) * Math.PI * 2 / 360) - height / 2) * Math.sin(2 * (90 - direction[1]) * Math.PI * 2 / 360) / 2;
                    y2 = Math.tan((90 - direction[1]) * Math.PI * 2 / 360) * x1;
                    x2 = -x1;
                    y1 = -y2;
                }
                else {
                    x1 = -(width / 2) - (-(width / 2) * Math.tan((90 - direction[1]) * Math.PI * 2 / 360) - height / 2) * Math.sin(2 * (90 - direction[1]) * Math.PI * 2 / 360) / 2;
                    y2 = Math.tan((90 - direction[1]) * Math.PI * 2 / 360) * x1;
                    x2 = -x1;
                    y1 = -y2;
                }
                coordinate = [x1, y1, x2, y2];
                break;
        }
        return coordinate;
    }
    function linearEffect(width, height, bg, ctx) {
        var param = analizeLinear(bg, width, height);
        var grd = ctx.createLinearGradient(param[0], param[1], param[2], param[3]);
        var content = bg.match(/linear-gradient\((.+)\)/)[1];
        var colorPer = analizeGrad(content.substring(content.indexOf(',') + 1));
        for (var i = 0; i < colorPer.colors.length; i++) {
            grd.addColorStop(colorPer.percents[i], colorPer.colors[i]);
        }
        ctx.fillStyle = grd;
    }
    module.exports = { api: api };
}());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JhZGllbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMveHhwYWludC9saWIvZ3JhZGllbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUlBLENBQUMsQ0FBQztJQUNBLElBQU0sR0FBRyxHQUFHO1FBQ1YsVUFBVSxZQUFDLEVBQUU7WUFDWCxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFO2dCQUM5RCxPQUFPLElBQUksQ0FBQzthQUNiO1lBQ0QsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDO1FBRUQsVUFBVSxZQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEdBQUc7WUFDL0IsSUFBSSxFQUFFLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFO2dCQUMzQixZQUFZLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUM7YUFDdEM7aUJBQU0sSUFBSSxFQUFFLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFO2dCQUNsQyxZQUFZLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUM7YUFDdEM7UUFDSCxDQUFDO0tBQ0YsQ0FBQztJQUVGLFNBQVMsV0FBVyxDQUFDLE1BQU07UUFDekIsSUFBTSxhQUFhLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekUsSUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFDO1FBQ2xCLElBQU0sUUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNwQixLQUEyQixVQUFhLEVBQWIsK0JBQWEsRUFBYiwyQkFBYSxFQUFiLElBQWEsRUFBRTtZQUFyQyxJQUFNLFlBQVksc0JBQUE7WUFDckIsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxZQUFZLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUM3RSxRQUFRLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsRUFBRSxZQUFZLENBQUMsTUFBTSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7U0FDakc7UUFDRCxPQUFPLEVBQUUsTUFBTSxRQUFBLEVBQUUsUUFBUSxVQUFBLEVBQUUsQ0FBQztJQUM5QixDQUFDO0lBRUQsU0FBUyxZQUFZLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsR0FBRztRQUMxQyxJQUFNLFFBQVEsR0FBRyxXQUFXLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDckUsSUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLHNCQUFzQixDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsS0FBSyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3RGLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUMvQyxHQUFHLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQzVEO1FBQ0QsR0FBRyxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUM7SUFFdEIsQ0FBQztJQUVELFNBQVMsYUFBYSxDQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsTUFBTTtRQUN0QyxJQUFNLFNBQVMsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFDL0MsSUFBTSxHQUFHLEdBQUcsU0FBUyxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDckUsSUFBSSxVQUFVLENBQUM7UUFDZixRQUFRLEdBQUcsRUFBRTtZQUNiLEtBQUssQ0FBQztnQkFBRSxVQUFVLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQUMsTUFBTTtZQUM1RCxLQUFLLEVBQUU7Z0JBQUUsVUFBVSxHQUFHLENBQUMsS0FBSyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUFDLE1BQU07WUFDM0QsS0FBSyxDQUFDLEVBQUU7Z0JBQUUsVUFBVSxHQUFHLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUFDLE1BQU07WUFDNUQsS0FBSyxHQUFHO2dCQUFFLFVBQVUsR0FBRyxDQUFDLENBQUMsRUFBRSxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFBQyxNQUFNO1lBQzlELEtBQUssQ0FBQyxHQUFHO2dCQUFFLFVBQVUsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFBQyxNQUFNO1lBQy9EO2dCQUNFLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDWCxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7Z0JBQ1gsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUNYLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDWCxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTtvQkFDekMsRUFBRSxHQUFHLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUM5SixFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7b0JBQzVELEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQztvQkFDVCxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUM7aUJBQ1Y7cUJBQU0sSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFO29CQUNwRCxFQUFFLEdBQUcsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDL0osRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDO29CQUM1RCxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUM7b0JBQ1QsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDO2lCQUNWO3FCQUFNLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxFQUFFO29CQUNsRCxFQUFFLEdBQUcsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDL0osRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDO29CQUM1RCxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUM7b0JBQ1QsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDO2lCQUNWO3FCQUFNO29CQUNMLEVBQUUsR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQ2hLLEVBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztvQkFDNUQsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDO29CQUNULEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQztpQkFDVjtnQkFDRCxVQUFVLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDOUIsTUFBTTtTQUNQO1FBQ0QsT0FBTyxVQUFVLENBQUM7SUFDcEIsQ0FBQztJQUVELFNBQVMsWUFBWSxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLEdBQUc7UUFDMUMsSUFBTSxLQUFLLEdBQUcsYUFBYSxDQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDL0MsSUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLG9CQUFvQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdFLElBQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMseUJBQXlCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN2RCxJQUFNLFFBQVEsR0FBRyxXQUFXLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUUsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQy9DLEdBQUcsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRSxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDNUQ7UUFDRCxHQUFHLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQztJQUV0QixDQUFDO0lBRUQsTUFBTSxDQUFDLE9BQU8sR0FBRyxFQUFFLEdBQUcsS0FBQSxFQUFFLENBQUM7QUFDM0IsQ0FBQyxFQUFFLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIOW9k2N0eOS8oOWFpeW9k+WJjeaWh+S7tu+8jGNvbnN0IGdyZCA9IGN0eC5jcmVhdGVDaXJjdWxhckdyYWRpZW50KCkg5ZKMXG4vLyBjb25zdCBncmQgPSB0aGlzLmN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCgpIOaXoOaViO+8jOWboOatpOWPquiDveWIhuW8gOWkhOeQhlxuLy8g5YWI5YiG5p6Q77yM5Zyo5aSW6YOo5Yib5bu6Z3Jk77yM5YaN5Lyg5YWl5L2/55So5bCx5Y+v5LulXG5cbiEoZnVuY3Rpb24gKCkge1xuICBjb25zdCBhcGkgPSB7XG4gICAgaXNHcmFkaWVudChiZykge1xuICAgICAgaWYgKGJnICYmIChiZy5zdGFydHNXaXRoKCdsaW5lYXInKSB8fCBiZy5zdGFydHNXaXRoKCdyYWRpYWwnKSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGRvR3JhZGllbnQoYmcsIHdpZHRoLCBoZWlnaHQsIGN0eCkge1xuICAgICAgaWYgKGJnLnN0YXJ0c1dpdGgoJ2xpbmVhcicpKSB7XG4gICAgICAgIGxpbmVhckVmZmVjdCh3aWR0aCwgaGVpZ2h0LCBiZywgY3R4KTtcbiAgICAgIH0gZWxzZSBpZiAoYmcuc3RhcnRzV2l0aCgncmFkaWFsJykpIHtcbiAgICAgICAgcmFkaWFsRWZmZWN0KHdpZHRoLCBoZWlnaHQsIGJnLCBjdHgpO1xuICAgICAgfVxuICAgIH0sXG4gIH07XG5cbiAgZnVuY3Rpb24gYW5hbGl6ZUdyYWQoc3RyaW5nKSB7XG4gICAgY29uc3QgY29sb3JQZXJjZW50cyA9IHN0cmluZy5zdWJzdHJpbmcoMCwgc3RyaW5nLmxlbmd0aCAtIDEpLnNwbGl0KCclLCcpO1xuICAgIGNvbnN0IGNvbG9ycyA9IFtdO1xuICAgIGNvbnN0IHBlcmNlbnRzID0gW107XG4gICAgZm9yIChjb25zdCBjb2xvclBlcmNlbnQgb2YgY29sb3JQZXJjZW50cykge1xuICAgICAgY29sb3JzLnB1c2goY29sb3JQZXJjZW50LnN1YnN0cmluZygwLCBjb2xvclBlcmNlbnQubGFzdEluZGV4T2YoJyAnKSkudHJpbSgpKTtcbiAgICAgIHBlcmNlbnRzLnB1c2goY29sb3JQZXJjZW50LnN1YnN0cmluZyhjb2xvclBlcmNlbnQubGFzdEluZGV4T2YoJyAnKSwgY29sb3JQZXJjZW50Lmxlbmd0aCkgLyAxMDApO1xuICAgIH1cbiAgICByZXR1cm4geyBjb2xvcnMsIHBlcmNlbnRzIH07XG4gIH1cblxuICBmdW5jdGlvbiByYWRpYWxFZmZlY3Qod2lkdGgsIGhlaWdodCwgYmcsIGN0eCkge1xuICAgIGNvbnN0IGNvbG9yUGVyID0gYW5hbGl6ZUdyYWQoYmcubWF0Y2goL3JhZGlhbC1ncmFkaWVudFxcKCguKylcXCkvKVsxXSk7XG4gICAgY29uc3QgZ3JkID0gY3R4LmNyZWF0ZUNpcmN1bGFyR3JhZGllbnQoMCwgMCwgd2lkdGggPCBoZWlnaHQgPyBoZWlnaHQgLyAyIDogd2lkdGggLyAyKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbG9yUGVyLmNvbG9ycy5sZW5ndGg7IGkrKykge1xuICAgICAgZ3JkLmFkZENvbG9yU3RvcChjb2xvclBlci5wZXJjZW50c1tpXSwgY29sb3JQZXIuY29sb3JzW2ldKTtcbiAgICB9XG4gICAgY3R4LmZpbGxTdHlsZSA9IGdyZDtcbiAgICAvLyBjdHguZmlsbFJlY3QoLSh3aWR0aCAvIDIpLCAtKGhlaWdodCAvIDIpLCB3aWR0aCwgaGVpZ2h0KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFuYWxpemVMaW5lYXIoYmcsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICBjb25zdCBkaXJlY3Rpb24gPSBiZy5tYXRjaCgvKFstXT9cXGR7MSwzfSlkZWcvKTtcbiAgICBjb25zdCBkaXIgPSBkaXJlY3Rpb24gJiYgZGlyZWN0aW9uWzFdID8gcGFyc2VGbG9hdChkaXJlY3Rpb25bMV0pIDogMDtcbiAgICBsZXQgY29vcmRpbmF0ZTtcbiAgICBzd2l0Y2ggKGRpcikge1xuICAgIGNhc2UgMDogY29vcmRpbmF0ZSA9IFswLCAtaGVpZ2h0IC8gMiwgMCwgaGVpZ2h0IC8gMl07IGJyZWFrO1xuICAgIGNhc2UgOTA6IGNvb3JkaW5hdGUgPSBbd2lkdGggLyAyLCAwLCAtd2lkdGggLyAyLCAwXTsgYnJlYWs7XG4gICAgY2FzZSAtOTA6IGNvb3JkaW5hdGUgPSBbLXdpZHRoIC8gMiwgMCwgd2lkdGggLyAyLCAwXTsgYnJlYWs7XG4gICAgY2FzZSAxODA6IGNvb3JkaW5hdGUgPSBbMCwgaGVpZ2h0IC8gMiwgMCwgLWhlaWdodCAvIDJdOyBicmVhaztcbiAgICBjYXNlIC0xODA6IGNvb3JkaW5hdGUgPSBbMCwgLWhlaWdodCAvIDIsIDAsIGhlaWdodCAvIDJdOyBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgbGV0IHgxID0gMDtcbiAgICAgIGxldCB5MSA9IDA7XG4gICAgICBsZXQgeDIgPSAwO1xuICAgICAgbGV0IHkyID0gMDtcbiAgICAgIGlmIChkaXJlY3Rpb25bMV0gPiAwICYmIGRpcmVjdGlvblsxXSA8IDkwKSB7XG4gICAgICAgIHgxID0gKHdpZHRoIC8gMikgLSAoKHdpZHRoIC8gMikgKiBNYXRoLnRhbigoOTAgLSBkaXJlY3Rpb25bMV0pICogTWF0aC5QSSAqIDIgLyAzNjApIC0gaGVpZ2h0IC8gMikgKiBNYXRoLnNpbigyICogKDkwIC0gZGlyZWN0aW9uWzFdKSAqIE1hdGguUEkgKiAyIC8gMzYwKSAvIDI7XG4gICAgICAgIHkyID0gTWF0aC50YW4oKDkwIC0gZGlyZWN0aW9uWzFdKSAqIE1hdGguUEkgKiAyIC8gMzYwKSAqIHgxO1xuICAgICAgICB4MiA9IC14MTtcbiAgICAgICAgeTEgPSAteTI7XG4gICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvblsxXSA+IC0xODAgJiYgZGlyZWN0aW9uWzFdIDwgLTkwKSB7XG4gICAgICAgIHgxID0gLSh3aWR0aCAvIDIpICsgKCh3aWR0aCAvIDIpICogTWF0aC50YW4oKDkwIC0gZGlyZWN0aW9uWzFdKSAqIE1hdGguUEkgKiAyIC8gMzYwKSAtIGhlaWdodCAvIDIpICogTWF0aC5zaW4oMiAqICg5MCAtIGRpcmVjdGlvblsxXSkgKiBNYXRoLlBJICogMiAvIDM2MCkgLyAyO1xuICAgICAgICB5MiA9IE1hdGgudGFuKCg5MCAtIGRpcmVjdGlvblsxXSkgKiBNYXRoLlBJICogMiAvIDM2MCkgKiB4MTtcbiAgICAgICAgeDIgPSAteDE7XG4gICAgICAgIHkxID0gLXkyO1xuICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb25bMV0gPiA5MCAmJiBkaXJlY3Rpb25bMV0gPCAxODApIHtcbiAgICAgICAgeDEgPSAod2lkdGggLyAyKSArICgtKHdpZHRoIC8gMikgKiBNYXRoLnRhbigoOTAgLSBkaXJlY3Rpb25bMV0pICogTWF0aC5QSSAqIDIgLyAzNjApIC0gaGVpZ2h0IC8gMikgKiBNYXRoLnNpbigyICogKDkwIC0gZGlyZWN0aW9uWzFdKSAqIE1hdGguUEkgKiAyIC8gMzYwKSAvIDI7XG4gICAgICAgIHkyID0gTWF0aC50YW4oKDkwIC0gZGlyZWN0aW9uWzFdKSAqIE1hdGguUEkgKiAyIC8gMzYwKSAqIHgxO1xuICAgICAgICB4MiA9IC14MTtcbiAgICAgICAgeTEgPSAteTI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB4MSA9IC0od2lkdGggLyAyKSAtICgtKHdpZHRoIC8gMikgKiBNYXRoLnRhbigoOTAgLSBkaXJlY3Rpb25bMV0pICogTWF0aC5QSSAqIDIgLyAzNjApIC0gaGVpZ2h0IC8gMikgKiBNYXRoLnNpbigyICogKDkwIC0gZGlyZWN0aW9uWzFdKSAqIE1hdGguUEkgKiAyIC8gMzYwKSAvIDI7XG4gICAgICAgIHkyID0gTWF0aC50YW4oKDkwIC0gZGlyZWN0aW9uWzFdKSAqIE1hdGguUEkgKiAyIC8gMzYwKSAqIHgxO1xuICAgICAgICB4MiA9IC14MTtcbiAgICAgICAgeTEgPSAteTI7XG4gICAgICB9XG4gICAgICBjb29yZGluYXRlID0gW3gxLCB5MSwgeDIsIHkyXTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm4gY29vcmRpbmF0ZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGxpbmVhckVmZmVjdCh3aWR0aCwgaGVpZ2h0LCBiZywgY3R4KSB7XG4gICAgY29uc3QgcGFyYW0gPSBhbmFsaXplTGluZWFyKGJnLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICBjb25zdCBncmQgPSBjdHguY3JlYXRlTGluZWFyR3JhZGllbnQocGFyYW1bMF0sIHBhcmFtWzFdLCBwYXJhbVsyXSwgcGFyYW1bM10pO1xuICAgIGNvbnN0IGNvbnRlbnQgPSBiZy5tYXRjaCgvbGluZWFyLWdyYWRpZW50XFwoKC4rKVxcKS8pWzFdO1xuICAgIGNvbnN0IGNvbG9yUGVyID0gYW5hbGl6ZUdyYWQoY29udGVudC5zdWJzdHJpbmcoY29udGVudC5pbmRleE9mKCcsJykgKyAxKSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2xvclBlci5jb2xvcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGdyZC5hZGRDb2xvclN0b3AoY29sb3JQZXIucGVyY2VudHNbaV0sIGNvbG9yUGVyLmNvbG9yc1tpXSk7XG4gICAgfVxuICAgIGN0eC5maWxsU3R5bGUgPSBncmQ7XG4gICAgLy8gY3R4LmZpbGxSZWN0KC0od2lkdGggLyAyKSwgLShoZWlnaHQgLyAyKSwgd2lkdGgsIGhlaWdodCk7XG4gIH1cblxuICBtb2R1bGUuZXhwb3J0cyA9IHsgYXBpIH07XG59KCkpO1xuIl19